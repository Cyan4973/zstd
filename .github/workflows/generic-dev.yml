name: generic-dev

on:
  pull_request:
    branches: [ dev, release, actionsTest ]

jobs:

# Dev PR jobs that still have to be migrated from travis
#
# versionTag (only on release tags)
# valgrindTest (keeps failing for some reason. need investigation)
# staticAnalyze (need trusty so need self-hosted)
# pcc-fuzz: (need trusty so need self-hosted)
# min-decomp-macros (flakey)
#
# setting up self-hosted is pretty straightforward, but
# I need admins permissions to the repo for that it looks like
# So I'm tabling that for now
#
# The release branch exclusive jobs will be in a separate
# workflow file (the osx tests and meson build that is)
  windows-builds:
    strategy:  
      matrix:
        compiler: [gcc, clang, clang-cl, visual]
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v2
    - name: Add clang path to $PATH env
      run: |
        echo "PATH=$PATH:C:\msys64\mingw64\bin" >> $GITHUB_ENV
    - name: make (with ${{ matrix.compiler }})
      run: |
        set CC=${{ matrix.compiler }}
        make clean
        make check

  cmake-windows:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v2
    - name: cmake build and test check
      run: |
        set FUZZERTEST=-T1mn
        set ZSTREAM_TESTTIME=-T1mn
        make